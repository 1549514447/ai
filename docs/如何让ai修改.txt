需要提供的关键文件
historical_analysis_processor.py
这是需要修改的主要文件之一
包含了_claude_enhanced_historical_insights方法，该方法直接调用了Claude客户端的analyze_complex_query方法
prediction_processor.py
这是需要修改的另一个文件
虽然没有直接调用Claude客户端的方法，但它将Claude客户端传递给了其他组件
current_data_processor.py
作为参考实现，展示了如何修改代码以适应不同版本的Anthropic SDK
包含了_cached_ai_analysis方法，该方法实现了健壮的API调用逻辑
claude_client.py
包含了Claude客户端的实现和analyze_complex_query方法
了解客户端初始化和方法调用的关键文件
core/analyzers/insight_generator.py
因为两个处理器都使用了这个组件，可能也需要检查它是否直接使用了Claude客户端
需要提供的关键信息
SDK版本和错误信息
Anthropic SDK 0.7.7版本
错误信息：'Anthropic' object has no attribute 'messages'
这表明在较新版本的SDK中API调用方式发生了变化
解决方案模式
在current_data_processor.py中实现的健壮客户端调用逻辑
包括尝试多种API调用方式（messages API、completions API和直接方法调用）
完善的错误处理和日志记录
关键修改点
historical_analysis_processor.py中的_claude_enhanced_historical_insights方法（第768行）
任何直接或间接使用Claude客户端的方法
需要确保所有组件都能适应不同版本的SDK
依赖关系
两个处理器都依赖于多个核心组件，这些组件可能也需要修改
特别是那些直接使用Claude客户端的组件
通过提供这些文件和信息，新的AI将能够全面了解系统架构和当前问题，从而实现必要的修改，确保historical_analysis_processor.py和prediction_processor.py与最新版本的Anthropic SDK兼容。