# ğŸ“Š Utils å·¥å…·æ¨¡å—ä»£ç æ€»ç»“

æœ¬æ¨¡å—åŒ…å«å››ä¸ªæ ¸å¿ƒå·¥å…·ç±»ï¼Œä¸ºé‡‘èAIåˆ†æç³»ç»Ÿæä¾›åº•å±‚æ”¯æŒåŠŸèƒ½ã€‚

## ğŸ“… date_utils.py - AIé©±åŠ¨çš„æ™ºèƒ½æ—¥æœŸå·¥å…·

### æ ¸å¿ƒåŠŸèƒ½
- **AIæ—¥æœŸè§£æ**: ä½¿ç”¨Claudeå®¢æˆ·ç«¯ç†è§£è‡ªç„¶è¯­è¨€æ—¥æœŸè¡¨è¾¾
- **æ™ºèƒ½æ—¶é—´èŒƒå›´æ¨æ–­**: æ ¹æ®æŸ¥è¯¢ç±»å‹è‡ªåŠ¨æ¨èæœ€ä¼˜æ—¶é—´èŒƒå›´
- **æ ¼å¼è½¬æ¢**: æ”¯æŒæ ‡å‡†æ ¼å¼(YYYY-MM-DD)ä¸APIæ ¼å¼(YYYYMMDD)äº’è½¬
- **ä¸šåŠ¡æ—¶é—´å‘¨æœŸ**: æä¾›å¸¸ç”¨ä¸šåŠ¡æ—¶é—´æ®µ(ä»Šå¤©ã€æœ¬å‘¨ã€æœ¬æœˆç­‰)

### å…³é”®ç±»å’Œæ•°æ®ç»“æ„
```python
@dataclass
class DateRange:
    start_date: str          # YYYY-MM-DD
    end_date: str           # YYYY-MM-DD
    range_type: str         # specific/relative/inferred
    confidence: float       # 0.0-1.0
    description: str

@dataclass
class DateParseResult:
    dates: List[str]                # å…·ä½“æ—¥æœŸåˆ—è¡¨
    ranges: List[DateRange]         # æ—¥æœŸèŒƒå›´åˆ—è¡¨
    relative_terms: List[str]       # ç›¸å¯¹æ—¶é—´æœ¯è¯­
    has_time_info: bool            # æ˜¯å¦åŒ…å«æ—¶é—´ä¿¡æ¯
    parse_confidence: float        # è§£æç½®ä¿¡åº¦
    api_format_dates: List[str]    # APIæ ¼å¼æ—¥æœŸ
```

### æ ¸å¿ƒæ–¹æ³•
- `parse_dates_from_query()`: AIè§£ææŸ¥è¯¢ä¸­çš„æ—¥æœŸä¿¡æ¯
- `infer_optimal_time_range()`: æ™ºèƒ½æ¨æ–­æœ€ä¼˜æ—¶é—´èŒƒå›´
- `generate_date_range()`: ç”Ÿæˆæ—¥æœŸèŒƒå›´åˆ—è¡¨
- `get_business_periods()`: è·å–å¸¸ç”¨ä¸šåŠ¡æ—¶é—´å‘¨æœŸ

---

## ğŸ›¡ï¸ validation_utils.py - AIé©±åŠ¨çš„æ™ºèƒ½æ•°æ®éªŒè¯å™¨

### æ ¸å¿ƒåŠŸèƒ½
- **å¤šå±‚æ¬¡éªŒè¯**: åŸºç¡€â†’æ ‡å‡†â†’ä¸¥æ ¼â†’AIå¢å¼ºå››ä¸ªéªŒè¯çº§åˆ«
- **é‡‘èä¸šåŠ¡é€»è¾‘éªŒè¯**: ä¸“é—¨é’ˆå¯¹é‡‘èæ•°æ®çš„åˆç†æ€§æ£€æŸ¥
- **AIè¾…åŠ©éªŒè¯**: Claudeè´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼ŒGPTè´Ÿè´£æ•°å€¼ä¸€è‡´æ€§
- **æ™ºèƒ½å¼‚å¸¸æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«æ•°æ®å¼‚å¸¸å¹¶æä¾›ä¿®å¤å»ºè®®

### å…³é”®æšä¸¾å’Œæ•°æ®ç»“æ„
```python
class ValidationLevel(Enum):
    BASIC = "basic"              # åŸºç¡€éªŒè¯
    STANDARD = "standard"        # æ ‡å‡†éªŒè¯
    STRICT = "strict"           # ä¸¥æ ¼éªŒè¯
    AI_ENHANCED = "ai_enhanced"  # AIå¢å¼ºéªŒè¯

@dataclass
class ValidationIssue:
    field: str                   # å­—æ®µå
    issue_type: str             # é—®é¢˜ç±»å‹
    severity: ValidationSeverity # ä¸¥é‡ç¨‹åº¦
    message: str                # é—®é¢˜æè¿°
    current_value: Any          # å½“å‰å€¼
    suggested_value: Any        # å»ºè®®å€¼
    fix_suggestion: str         # ä¿®å¤å»ºè®®

@dataclass
class ValidationResult:
    is_valid: bool              # æ˜¯å¦é€šè¿‡éªŒè¯
    overall_score: float        # æ€»ä½“è¯„åˆ†(0-1)
    issues: List[ValidationIssue] # é—®é¢˜åˆ—è¡¨
    warnings_count: int         # è­¦å‘Šæ•°é‡
    errors_count: int          # é”™è¯¯æ•°é‡
```

### æ ¸å¿ƒæ–¹æ³•
- `validate_data()`: é€šç”¨æ•°æ®éªŒè¯å…¥å£
- `validate_api_response()`: APIå“åº”éªŒè¯
- `validate_financial_data()`: é‡‘èæ•°æ®éªŒè¯
- `_ai_enhanced_validation()`: AIå¢å¼ºéªŒè¯

---

## ğŸ“ˆ time_series_builder.py - AIè¾…åŠ©çš„æ—¶é—´åºåˆ—æ•°æ®æ„å»ºå™¨

### æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½æ•°æ®å¯¹é½**: è‡ªåŠ¨è¡¥å…¨ç¼ºå¤±æ—¥æœŸå¹¶æ’å€¼
- **å¼‚å¸¸å€¼æ£€æµ‹**: åŸºäºç»Ÿè®¡æ–¹æ³•+AIéªŒè¯çš„å¼‚å¸¸å€¼å¤„ç†
- **å¤šæŒ‡æ ‡æ”¯æŒ**: åŒæ—¶æ„å»ºå¤šä¸ªæŒ‡æ ‡çš„æ—¶é—´åºåˆ—
- **èšåˆåˆ†æ**: æ”¯æŒå‘¨åº¦ã€æœˆåº¦ç­‰æ—¶é—´èšåˆ
- **ç›¸å…³æ€§è®¡ç®—**: è‡ªåŠ¨è®¡ç®—æŒ‡æ ‡é—´ç›¸å…³æ€§

### å…³é”®æšä¸¾å’Œæ•°æ®ç»“æ„
```python
class TimeSeriesType(Enum):
    DAILY = "daily"              # æ¯æ—¥æ•°æ®
    WEEKLY = "weekly"            # å‘¨åº¦æ•°æ®
    MONTHLY = "monthly"          # æœˆåº¦æ•°æ®
    CUMULATIVE = "cumulative"    # ç´¯è®¡æ•°æ®
    MOVING_AVERAGE = "moving_avg" # ç§»åŠ¨å¹³å‡

@dataclass
class TimeSeriesPoint:
    date: str                    # æ—¥æœŸ(YYYY-MM-DD)
    value: float                 # æ•°å€¼
    is_interpolated: bool        # æ˜¯å¦ä¸ºæ’å€¼
    is_outlier: bool            # æ˜¯å¦ä¸ºå¼‚å¸¸å€¼
    confidence: float           # æ•°æ®ç½®ä¿¡åº¦
    metadata: Dict[str, Any]    # é¢å¤–å…ƒæ•°æ®

@dataclass
class TimeSeriesMetadata:
    series_type: TimeSeriesType  # åºåˆ—ç±»å‹
    date_range: Tuple[str, str] # æ—¥æœŸèŒƒå›´
    total_points: int           # æ€»æ•°æ®ç‚¹æ•°
    missing_points: int         # ç¼ºå¤±æ•°æ®ç‚¹æ•°
    data_quality: DataQuality   # æ•°æ®è´¨é‡ç­‰çº§
    confidence_score: float     # æ•°æ®ç½®ä¿¡åº¦
```

### æ ¸å¿ƒæ–¹æ³•
- `build_daily_time_series()`: æ„å»ºæ¯æ—¥æ—¶é—´åºåˆ—
- `build_multi_metric_series()`: æ„å»ºå¤šæŒ‡æ ‡æ—¶é—´åºåˆ—
- `build_aggregated_series()`: æ„å»ºèšåˆæ—¶é—´åºåˆ—
- `_detect_and_handle_outliers()`: å¼‚å¸¸å€¼æ£€æµ‹å’Œå¤„ç†
- `_calculate_correlations()`: è®¡ç®—æŒ‡æ ‡é—´ç›¸å…³æ€§

---

## ğŸ’° financial_calculator.py - AIè¾…åŠ©çš„é‡‘èè®¡ç®—å¼•æ“

### æ ¸å¿ƒåŠŸèƒ½
- **é«˜ç²¾åº¦è®¡ç®—**: ä½¿ç”¨Decimalé¿å…æµ®ç‚¹è¯¯å·®
- **å¤æŠ•åœºæ™¯æ¨¡æ‹Ÿ**: æ”¯æŒå¤šç§å¤æŠ•/æç°ç­–ç•¥æ¨¡æ‹Ÿ
- **å¢é•¿ç‡åˆ†æ**: æ”¯æŒç®€å•ã€å¤åˆã€å¹³å‡å¢é•¿ç‡è®¡ç®—
- **é£é™©è¯„ä¼°**: è®¡ç®—å„ç§é‡‘èé£é™©æŒ‡æ ‡
- **AIéªŒè¯**: GPTéªŒè¯å¤æ‚è®¡ç®—é€»è¾‘

### å…³é”®æšä¸¾å’Œæ•°æ®ç»“æ„
```python
class CalculationType(Enum):
    SIMPLE = "simple"            # ç®€å•è®¡ç®—
    COMPOUND = "compound"        # å¤åˆ©è®¡ç®—
    REINVESTMENT = "reinvestment" # å¤æŠ•è®¡ç®—
    PREDICTION = "prediction"     # é¢„æµ‹è®¡ç®—
    RISK_ANALYSIS = "risk"       # é£é™©åˆ†æ

@dataclass
class CalculationResult:
    result_value: float          # è®¡ç®—ç»“æœå€¼
    calculation_type: CalculationType # è®¡ç®—ç±»å‹
    calculation_steps: List[Dict] # è®¡ç®—æ­¥éª¤
    confidence_score: float      # è®¡ç®—ç½®ä¿¡åº¦
    warnings: List[str]         # è®¡ç®—è­¦å‘Š
    metadata: Dict[str, Any]    # é¢å¤–ä¿¡æ¯

@dataclass
class ReinvestmentScenario:
    reinvestment_rate: float     # å¤æŠ•ç‡
    cashout_rate: float         # æç°ç‡
    compound_frequency: int     # å¤åˆ©é¢‘ç‡(å¤©)
    scenario_name: str          # åœºæ™¯åç§°

@dataclass
class GrowthAnalysis:
    growth_rate: float          # å¢é•¿ç‡
    trend_direction: str        # è¶‹åŠ¿æ–¹å‘
    volatility: float          # æ³¢åŠ¨æ€§
    confidence_level: float    # ç½®ä¿¡æ°´å¹³
    supporting_data: List[float] # æ”¯æ’‘æ•°æ®
```

### æ ¸å¿ƒæ–¹æ³•
- `calculate_compound_interest()`: å¤åˆ©è®¡ç®—
- `calculate_reinvestment_impact()`: å¤æŠ•å½±å“è®¡ç®—
- `calculate_growth_rate()`: å¢é•¿ç‡è®¡ç®—
- `calculate_financial_ratios()`: é‡‘èæ¯”ç‡è®¡ç®—
- `simulate_reinvestment_scenarios()`: å¤æŠ•åœºæ™¯æ¨¡æ‹Ÿ
- `predict_future_value()`: æœªæ¥ä»·å€¼é¢„æµ‹

---

## ğŸ”— æ¨¡å—é—´åä½œå…³ç³»

```
date_utils.py â†â†’ validation_utils.py (æ—¥æœŸéªŒè¯)
    â†“
time_series_builder.py â†â†’ financial_calculator.py (æ•°å€¼è®¡ç®—)
    â†“
æä¾›ç»™ä¸Šå±‚åˆ†æå™¨ä½¿ç”¨
```

## ğŸ¯ è®¾è®¡ç‰¹ç‚¹

1. **AIä¼˜å…ˆ**: æ‰€æœ‰æ¨¡å—éƒ½æ”¯æŒAIå®¢æˆ·ç«¯å¢å¼ºåŠŸèƒ½
2. **å®¹é”™è®¾è®¡**: AIä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§åˆ°åŸºç¡€åŠŸèƒ½
3. **æ•°æ®ç±»é©±åŠ¨**: ä½¿ç”¨dataclassç¡®ä¿æ•°æ®ç»“æ„æ¸…æ™°
4. **é«˜ç²¾åº¦**: é‡‘èè®¡ç®—ä½¿ç”¨Decimalç¡®ä¿ç²¾åº¦
5. **å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºåŠŸèƒ½æ‰©å±•
6. **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰æ¨¡å—éƒ½æä¾›å·¥å‚å‡½æ•°åˆ›å»ºå®ä¾‹

è¿™å››ä¸ªå·¥å…·æ¨¡å—æ„æˆäº†é‡‘èAIåˆ†æç³»ç»Ÿçš„åº•å±‚åŸºç¡€ï¼Œä¸ºä¸Šå±‚çš„æ•°æ®åˆ†æã€æ´å¯Ÿç”Ÿæˆç­‰åŠŸèƒ½æä¾›å¯é çš„å·¥å…·æ”¯æŒã€‚